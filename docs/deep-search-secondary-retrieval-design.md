# 深度检索二次检索功能设计文档

## 需求概述
在深度检索结果的图书列表中添加二次检索功能，与简单检索的二次检索功能保持一致。

## 功能描述
- 在DeepSearchBookList组件的操作按钮区域添加"二次检索"按钮
- 点击后，将选中的图书信息与原始输入组合，填充到输入框
- 切换回简单检索模式并执行检索

## 组件变更

### 1. DeepSearchBookList.tsx
- **新增Props**: `onSecondaryRetrieval: (selectedBooks: BookInfo[], query: string) => void`
- **新增按钮**: 在操作按钮区域添加"二次检索"按钮
- **按钮逻辑**:
  - 仅在有选中图书时启用
  - 调用`onSecondaryRetrieval`回调
  - 传递选中的图书列表和用户原始输入

### 2. AIBotOverlay.tsx
- **新增回调函数**: `handleDeepSearchSecondaryRetrieval`
- **回调逻辑**:
  - 调用`formatBooksForSecondarySearch`格式化文本
  - 填充输入框
  - 清空选择状态
  - 退出深度模式(`setDeepMode(false)`)
  - 设置检索阶段为'search'
  - **重要**: 不清空现有消息历史，新的检索结果追加在原有信息后面

## UI/UX设计
- 按钮样式：与其他操作按钮保持一致的设计风格
- 按钮文案：使用"二次检索"
- 按钮位置：放在"深度解读"按钮旁边
- 提示信息：hover时显示"基于选中图书进行二次检索"

## 实现要点
1. 复用现有的`formatBooksForSecondarySearch`工具函数
2. 确保切换到简单检索模式时正确清理状态
3. 保持与简单检索二次检索完全一致的行为
4. 按钮仅在选中图书时启用
5. **关键**: 二次检索不清空聊天历史，新的日志进度和检索结果追加显示

## 测试要点
1. 选中1本或多本图书后，二次检索按钮是否启用
2. 点击后是否正确填充输入框
3. 是否成功切换到简单检索模式
4. 执行的检索是否为简单检索（非深度检索）
5. **关键验证**: 原有的深度检索聊天历史是否保留
6. 新的检索日志和结果是否追加在历史信息后面，而不是清空重来