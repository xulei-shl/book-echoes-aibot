# 开发变更记录
- **日期**: 2025-12-16
- **对应设计文档**: [AIBot本地对话模块_20251216](../design/AIBot本地对话模块_20251216.md)

## 1. 变更摘要
- 新增 AIBot 本地模式核心模块（常量、类型、环境变量工具、提示词缓存、检索与研究工作流、DuckDuckGo MCP 回退逻辑）。
- 新增 `/api/local-aibot/draft` 与 `/api/local-aibot/chat` Route Handler，支持草稿生成与图书检索串联。
- 实现前端入口、Zustand 状态、对话浮层及消息流组件，集成深度检索草稿流程与复制/重试操作。
- 补充 `vitest` 单元测试覆盖环境变量工具，并新增 changelog 记录。

## 2. 文件清单
- `src/utils/logger.ts`: 新增结构化日志工具。
- `src/utils/aibot-env.ts`: 新增本地开关、LLM 配置解析等工具方法。
- `src/core/aibot/*`: 新增 constants、types、promptLoader、retrievalService、researchWorkflow、DuckDuckGo 集成。
- `app/api/local-aibot/draft/route.ts`: 新增草稿生成 API。
- `app/api/local-aibot/chat/route.ts`: 新增会话流式 API。
- `components/aibot/*`: 新增 Launcher、Overlay、MessageStream 组件。
- `store/aibot/useAIBotStore.ts`: 新增 Zustand 状态容器。
- `components/HomeNavigation.tsx`: 新增“本地对话”入口。
- `tests/aibot/env.test.ts`: 新增 vitest 单测。
- `vitest.config.ts`: 新增 vitest 配置。
- `docs/changelog/20251216_AIBot本地对话模块.md`: 当前文档。

## 3. 测试结果
- [x] 单元测试通过（`npm run test`）
- [ ] 核心路径验证通过（待浏览器验证）
