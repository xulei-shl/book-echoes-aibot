# 开发变更记录
- **日期**: 2025-12-17
- **对应设计文档**: [docs/design/aibot_question_classifier_20251217.md](../design/aibot_question_classifier_20251217.md)

## 1. 变更摘要
- 为 `/api/local-aibot/chat` 增加 gpt-4.1-nano 问题分类前置流程，异常输入直接返回固定引导语。
- 新增 `src/core/aibot/classifier.ts` 模块、提示词 `public/prompts/aibot_question_classifier.md`，并暴露注入检测与 bypass 逻辑。
- 补充分类单元测试，记录意图与模式信息到响应头。

## 2. 文件清单
- `src/core/aibot/constants.ts`: 新增分类常量与提示词标识。
- `src/core/aibot/types.ts`: 扩展意图分类类型定义。
- `src/core/aibot/classifier.ts`: 新增分类实现与安全辅助函数。
- `app/api/local-aibot/chat/route.ts`: 接入分类、注入检测与固定回复。
- `public/prompts/aibot_question_classifier.md`: 新增系统提示词。
- `tests/core/aibot/classifier.spec.ts`: 新增分类单元测试。
- `docs/design/aibot_question_classifier_20251217.md`: 设计文档。

## 3. 测试结果
- [x] 单元测试通过（`npx vitest run tests/core/aibot/classifier.spec.ts`）
- [ ] 核心路径验证通过
